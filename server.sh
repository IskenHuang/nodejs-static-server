#!/bin/bash

# nodejs static server
port="${1:-3000}"
open "http://localhost:${port}/"
echo "Static file server running at => http://localhost:${port}"
echo "CTRL + C to shutdown"
# node -e 'var http=require("http"),url=require("url"),path=require("path"),fs=require("fs"),port=process.argv[1]||3000,backName="<<",log=function(r,e){var t=200===e?"\x1b[32m":"\x1b[31m";console.log("\x1b[36m",r.method,t,e,"\x1b[0m",r.url)},errorResponse=function(r,e,t,n){var o={"Content-Type":"text/plain"},s=404===r?"404 Not Found\n":n+"\n";log(e,r),t.writeHead(r,o),t.write(s),t.end()},normalResponse=function(r,e,t,n){var o={"Access-Control-Allow-Origin":"*"};log(r,200),e.writeHead(200,o),e.write(t,n),e.end()};http.createServer(function(r,e){var t=url.parse(r.url).pathname,n=path.join(process.cwd(),t);fs.exists(n,function(t){if(!t)return void errorResponse(404,r,e);var o=fs.statSync(n).isDirectory();o?fs.readdir(n,function(t,o){if(t)return errorResponse(500,r,e,t);var s="<html><head><style>body{margin:0;}.content{list-style:none;padding:10px;}.row{height:30px;line-height:30px}.row:hover{background-color:#f1f1f1}</style></head><body><ul class=\"content\">",a=function(e,t){t=t||e;var n="<li class=\"row\">";return n+="<a href=\""+r.url+t+"\">",n+=e,n+="</a></li>"};s+="/"===r.url?"":a(backName,"..");for(var i=0;i<o.length;i++){var l=o[i];l+=fs.statSync(n+l).isDirectory()?"/":"",s+=a(l)}return s+="</ul></body></html>",normalResponse(r,e,s)}):fs.readFile(n,"binary",function(t,n){return t?errorResponse(500,r,e,t):normalResponse(r,e,n,"binary")})})}).listen(parseInt(port,10));' "$port"

node -e 'var http=require("http"),url=require("url"),path=require("path"),fs=require("fs"),port=process.argv[1]||3e3,backName="<<",log=function(e,r){var o=200===r?"\x1b[32m":"\x1b[31m";console.log("\x1b[36m",e.method,o,r,"\x1b[0m",e.url)},errorResponse=function(e,r,o,t){var n={"Content-Type":"text/plain"},s=404===e?"404 Not Found\n":t+"\n";log(r,e),o.writeHead(e,n),o.write(s),o.end()},normalResponse=function(e,r,o,t){var n={"Access-Control-Allow-Origin":"*"};log(e,200),r.writeHead(200,n),r.write(o,t),r.end()};http.createServer(function(e,r){var o=url.parse(e.url).pathname,t=path.join(process.cwd(),o);fs.exists(t,function(o){if(!o)return void errorResponse(404,e,r);var n=fs.statSync(t).isDirectory();if(n)fs.readdir(t,function(o,n){if(o)return errorResponse(500,e,r,o);var s="<html><head><style>body{margin:0;}.content{list-style:none;padding:10px;}.row{height:30px;line-height:30px}.row:hover{background-color:#f1f1f1}</style></head><body><ul class=\"content\">",a=function(r,o){o=o||r;var t="<li class=\"row\">";return t+="<a href=\""+e.url+o+"\">",t+=r,t+="</a></li>"};s+="/"===e.url?"":a(backName,"..");for(var i=0;i<n.length;i++){var l=n[i];l+=fs.statSync(t+l).isDirectory()?"/":"",s+=a(l)}return s+="</ul></body></html>",normalResponse(e,r,s)});else{var s=fs.createReadStream(t,{flags:"r",encoding:"utf8",fd:null,mode:438,autoClose:!0});s.on("open",function(){s.pipe(r)}),s.on("error",function(o){errorResponse(500,e,r,o)})}})}).listen(parseInt(port,10));' "$port"